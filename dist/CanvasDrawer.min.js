"use strict";function Historian(){this.memo={},this.keys=[],this.r=this.g=this.b=this.a=0,this.submit=function(t,i,s,o,n){let e=i+" "+s+" "+o+" "+n;e in this.memo||(this.keys.push(e),this.memo[e]=[]),this.memo[e]=this.memo[e].concat(t)},this.submitVanilla=function(t){this.submit(t,this.r,this.g,this.b,this.a)},this.setColor=function(t,i,s,o){this.r=t,this.g=i,this.b=s,this.a=o},this.forget=function(){this.memo={},this.key=[]},this.getMemo=function(){return this.memo},this.getKeys=function(){return this.keys}}function Cartographer(t,i,s=function(){return[0,0]},o=function(t){},n=function(t){}){var e,r,a=$("#"+t),h=!1;a.css("cursor","grab");var l=[0,0];a.on({mousemove:function(t){h&&function(t){let s=t.pageY-e,o=t.pageX-r;i(o,s,l[0],l[1])}(t)},mousedown:function(t){a.css("cursor","grabbing"),l=s(),h=!0,e=t.pageY,r=t.pageX,a.scrollTop(),a.scrollLeft()},mouseleave:function(){h=!1,a.css("cursor","grab")},mouseup:function(){h=!1,a.css("cursor","grab")}}),a.on("wheel mousewheel",(function(t){t.preventDefault();let i=a.position();t.originalEvent.deltaY>0?n(t.pageX-i.left,t.pageY-i.top):t.originalEvent.deltaY<0&&o(t.pageX-i.left,t.pageY-i.top)}))}function Drawer(t,i){this.vertexShaderSource="\n        attribute vec2 a_position;\n        uniform vec2 u_resolution;\n        uniform vec2 u_scale;\n        uniform vec2 u_translation;\n\n        void main() {\n            vec2 scaledPosition = a_position * u_scale;\n            vec2 position = scaledPosition + u_translation;\n            \n            vec2 zeroToOne = position / u_resolution;\n            vec2 zeroToTwo = zeroToOne * 2.0;\n            vec2 clipSpace = zeroToTwo - 1.0;\n            clipSpace = clipSpace * vec2(1, -1);\n            gl_Position = vec4(clipSpace, 0, 1);\n        }\n    ",this.fragmentShaderSource="\n        precision mediump float;\n        uniform vec4 u_color;\n\n        void main() {\n            gl_FragColor = u_color;\n        }\n    ",this.createShader=function(t,i){var s=this.gl.createShader(t);if(this.gl.shaderSource(s,i),this.gl.compileShader(s),this.gl.getShaderParameter(s,this.gl.COMPILE_STATUS))return s;console.log(this.gl.getShaderInfoLog(s)),this.gl.deleteShader(s)},this.createProgram=function(t,i){var s=this.gl.createProgram();if(this.gl.attachShader(s,t),this.gl.attachShader(s,i),this.gl.linkProgram(s),this.gl.getProgramParameter(s,this.gl.LINK_STATUS))return s;console.log(this.gl.getProgramInfoLog(s)),this.gl.deleteProgram(s)},this.setColor=function(t,i,s,o){this.setColorVanilla(t,i,s,o),this.historian.setColor(t,i,s,o)},this.setColorVanilla=function(t,i,s,o){this.gl.uniform4f(this.colorUniformLocation,t,i,s,o)},this.setPositions=function(t){this.setPositionsVanilla(t),this.historian.submitVanilla(t)},this.setPositionsVanilla=function(t){this.gl.bufferData(this.gl.ARRAY_BUFFER,new Float32Array(t),this.gl.STATIC_DRAW)},this.draw=function(t,i,s,o,n){this.setColor(i,s,o,n),this.setPositions(t),this.drawFromBuffer(t.length/2)},this.drawFromBuffer=function(t){var i=this.gl.TRIANGLES;this.gl.drawArrays(i,0,t)},this.clear=function(t,i,s,o){this.gl.clearColor(t,i,s,o),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.historian.forget()},this.repeatTheHistory=function(){let t=this.historian.getKeys(),i=this.historian.getMemo();for(let s=0;s<t.length;s++){let o=t[s],n=o.split(" ");this.setColor(n[0],n[1],n[2],n[3]);let e=i[o];this.setPositionsVanilla(e),this.drawFromBuffer(e.length/2)}},this.setScale=function(t){this.scale=[t,t],this.gl.uniform2fv(this.scaleLocation,this.scale)},this.updateScale=function(t){this.setScale(t),this.redraw()},this.setTranslation=function(t,i){this.translation=[t,i],this.gl.uniform2fv(this.translationLocation,this.translation)},this.updateTranslation=function(t,i){this.setTranslation(t,i),this.redraw()},this.updateRelativeTranslaton=function(t,i){this.updateTranslation(this.translation[0]+t,this.translation[1]+i)},this.redraw=function(){this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height),this.gl.clear(this.gl.COLOR_BUFFER_BIT),this.gl.useProgram(this.program),this.gl.enableVertexAttribArray(this.positionLocation),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionBuffer);var t=this.gl.FLOAT;this.gl.vertexAttribPointer(this.positionLocation,2,t,!1,0,0),this.repeatTheHistory()},this.updateScaleIntoPoint=function(t,i,s){let o=t/this.scale[0];this.setScale(t),this.setTranslation(o*this.translation[0]+i-o*i,o*this.translation[1]+s-o*s),this.redraw()},this.setup=function(){var t=this.vertexShaderSource,i=this.fragmentShaderSource,s=this.createShader(this.gl.VERTEX_SHADER,t),o=this.createShader(this.gl.FRAGMENT_SHADER,i);this.program=this.createProgram(s,o),this.gl.useProgram(this.program),this.positionAttributeLocation=this.gl.getAttribLocation(this.program,"a_position"),this.resolutionUniformLocation=this.gl.getUniformLocation(this.program,"u_resolution"),this.colorUniformLocation=this.gl.getUniformLocation(this.program,"u_color"),this.scaleLocation=this.gl.getUniformLocation(this.program,"u_scale"),this.translationLocation=this.gl.getUniformLocation(this.program,"u_translation"),this.clear(0,0,0,0),this.gl.uniform2fv(this.scaleLocation,this.scale),this.gl.uniform2fv(this.translationLocation,this.translation),this.positionBuffer=this.gl.createBuffer(),this.gl.bindBuffer(this.gl.ARRAY_BUFFER,this.positionBuffer),this.gl.enableVertexAttribArray(this.positionAttributeLocation),this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height);var n=this.gl.FLOAT;this.gl.vertexAttribPointer(this.positionAttributeLocation,2,n,!1,0,0),this.gl.uniform2f(this.resolutionUniformLocation,this.gl.canvas.width,this.gl.canvas.height)},this.historian=new Historian,this.scale=[1,1],this.textures={},this.texturesList=[],this.translation=[0,0];var s=document.getElementById(t);this.gl=s.getContext("webgl"),this.gl?this.setup():i(),window.addEventListener("resize",(function(){drawer.gl.uniform2f(drawer.resolutionUniformLocation,drawer.gl.canvas.width,drawer.gl.canvas.height),drawer.redraw()}))}function PositionMaker(){this.reset=function(){this.positions=[]},this.addPolygon=function(t){let i=earcut(t);for(let s=0;s<i.length;s++)this.positions.push(t[2*i[s]]),this.positions.push(t[2*i[s]+1])},this.addLine=function(t,i,s,o,n){let e=s-t,r=o-i,a=Math.sqrt(e*e+r*r),h=[-r/a,e/a],l=[t,i],c=[s,o],u=[l[0]+h[0]*n,l[1]+h[1]*n],g=[l[0]-h[0]*n,l[1]-h[1]*n],f=[c[0]-h[0]*n,c[1]-h[1]*n],m=[c[0]+h[0]*n,c[1]+h[1]*n];this.positions.push(u[0],u[1],g[0],g[1],f[0],f[1],f[0],f[1],m[0],m[1],u[0],u[1])},this.addCircle=function(t,i,s,o=15){let n,e,r=2*Math.PI/o,a=t+s*Math.cos(0),h=i+s*Math.sin(0);for(let o=0;o<=2*Math.PI;o+=r)n=t+s*Math.cos(o),e=i+s*Math.sin(o),this.positions.push(t,i,a,h,n,e),a=n,h=e},this.addSequenceLine=function(t,i){for(let s=0;s<t.length/2-1;s++)this.addLine(t[2*s],t[2*s+1],t[2*s+2],t[2*s+3],i)},this.getPositionsList=function(){return this.positions},this.reset()}function CanvasDrawer(t){this.loadDataFromInfo=function(t,i){return t in this.info?this.info[t]:i},this.info=t;var i=this.loadDataFromInfo("id",!1),s=this.loadDataFromInfo("error",(function(){})),o=this.loadDataFromInfo("cartographer",!1),n=this.loadDataFromInfo("zoominrate",1.1),e=this.loadDataFromInfo("zoomoutrate",.9);if(!1!==i){if(this.drawer=new Drawer(i,s),o){let t=this.drawer;this.cartographer=new Cartographer("c",(function(i,s,o,n){t.updateTranslation(o+i,n+s)}),(function(){return t.translation}),(function(i,s){let o=t.scale[0];t.updateScaleIntoPoint(o*n,i,s)}),(function(i,s){let o=t.scale[0];t.updateScaleIntoPoint(o*e,i,s)}))}this.positionMaker=new PositionMaker,this.draw=function(t,i,s,o){drawer.draw(this.positionMaker.positions,t,i,s,o),this.positionMaker.reset()}}else console.log("CanvasDrawer can not found element with id that you pass or maybe you don't pass any id!")}